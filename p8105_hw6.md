p8105_hw6
================
Yiying Chen yc4776
2025-12-02

``` r
library(tidyverse)
homicide_data = read.csv("data/homicide-data.csv")

homicide_data_clean = homicide_data |>
  mutate(city_state = paste(city, state, sep = ", "),
         resolved = case_when(
      disposition == "Open/No arrest"  ~ 0,
      disposition != "Open/No arrest" ~ 1),
      victim_age = as.numeric(victim_age)) |>
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"))|>
  filter(victim_race %in% c("White","Black"))
```

``` r
library(broom)

baltimore_data = 
  homicide_data_clean |>
  filter(city_state == "Baltimore, MD")

set.seed(123)
baltimore_fit = 
  baltimore_data |> 
  glm(resolved ~ victim_age + victim_race + victim_sex, data = _, family = binomial()) 

baltimore_fit |> 
  broom::tidy(exponentiate = TRUE, conf.int = TRUE) |> 
  filter(term == "victim_sexMale") |> 
  select(term, OR = estimate, conf.low, conf.high) |> 
  knitr::kable(digits = 3)
```

| term           |    OR | conf.low | conf.high |
|:---------------|------:|---------:|----------:|
| victim_sexMale | 0.355 |    0.267 |     0.468 |

``` r
city_data =
  homicide_data_clean |>
  group_by(city_state) |>
  tidyr::nest() |>
  mutate(
    city_fit = purrr::map(
      data,
      ~ glm(
          resolved ~ victim_age + victim_sex + victim_race,
          data   = .x,
          family = binomial()
        )
    ),
    city_tidy = purrr::map(
      city_fit,
      ~ broom::tidy(.x, exponentiate = TRUE, conf.int = TRUE)
    )
  ) |>
  tidyr::unnest(city_tidy) |>
  ungroup() |>
  
  filter(term == "victim_sexMale") |>
  select(city_state, estimate, conf.low, conf.high)

city_data
```

    ## # A tibble: 47 × 4
    ##    city_state      estimate conf.low conf.high
    ##    <chr>              <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    0.430   0.132      1.16 
    ##  2 Atlanta, GA        0.512   0.323      0.789
    ##  3 Baltimore, MD      0.355   0.267      0.468
    ##  4 Baton Rouge, LA    0.319   0.160      0.596
    ##  5 Birmingham, AL     0.704   0.444      1.09 
    ##  6 Boston, MA         0.674   0.353      1.28 
    ##  7 Buffalo, NY        0.438   0.239      0.793
    ##  8 Charlotte, NC      0.301   0.143      0.572
    ##  9 Chicago, IL        0.391   0.321      0.476
    ## 10 Cincinnati, OH     0.206   0.0977     0.390
    ## # ℹ 37 more rows

``` r
city_data |>
  mutate(
    city_state = fct_reorder(city_state, estimate)
  ) |>
  ggplot(aes(x = estimate, y = city_state)) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0) +
  labs(
    x = "estimated ORs",
    y = "City",
    title = "Estimated ORs and CIs for each city for solving homicides comparing male victims to female victims"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 6),
    plot.title = element_text(size = 8)
  )
```

![](p8105_hw6_files/figure-gfm/problem_1_plot-1.png)<!-- -->

``` r
library(tidyverse)
library(p8105.datasets)
data("weather_df")

boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}

boot_straps = 
  tibble(strap_number = 1:5000) |>
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )

boot_straps |> 
  slice(1:3) |> 
  mutate(strap_sample = map(strap_sample, \(s) arrange(s, tmax))) |> 
  pull(strap_sample)
```

    ## [[1]]
    ## # A tibble: 2,190 × 6
    ##    name           id          date        prcp  tmax  tmin
    ##    <chr>          <chr>       <date>     <dbl> <dbl> <dbl>
    ##  1 Waterhole_WA   USS0023B17S 2021-12-26   102 -11.4 -18.3
    ##  2 Waterhole_WA   USS0023B17S 2021-12-26   102 -11.4 -18.3
    ##  3 Waterhole_WA   USS0023B17S 2022-12-21     0  -9.6 -18.4
    ##  4 Waterhole_WA   USS0023B17S 2022-12-21     0  -9.6 -18.4
    ##  5 CentralPark_NY USW00094728 2022-12-24     0  -9.3 -13.8
    ##  6 CentralPark_NY USW00094728 2022-12-24     0  -9.3 -13.8
    ##  7 Waterhole_WA   USS0023B17S 2022-02-22   102  -9.3 -16.6
    ##  8 Waterhole_WA   USS0023B17S 2021-12-29   102  -7.9 -15.4
    ##  9 CentralPark_NY USW00094728 2022-01-15     0  -6   -12.1
    ## 10 Waterhole_WA   USS0023B17S 2021-12-28     0  -6   -11.4
    ## # ℹ 2,180 more rows
    ## 
    ## [[2]]
    ## # A tibble: 2,190 × 6
    ##    name           id          date        prcp  tmax  tmin
    ##    <chr>          <chr>       <date>     <dbl> <dbl> <dbl>
    ##  1 Waterhole_WA   USS0023B17S 2021-12-27    25  -9.8 -19.6
    ##  2 Waterhole_WA   USS0023B17S 2021-12-27    25  -9.8 -19.6
    ##  3 Waterhole_WA   USS0023B17S 2022-12-21     0  -9.6 -18.4
    ##  4 CentralPark_NY USW00094728 2022-12-24     0  -9.3 -13.8
    ##  5 CentralPark_NY USW00094728 2022-12-24     0  -9.3 -13.8
    ##  6 Waterhole_WA   USS0023B17S 2021-12-29   102  -7.9 -15.4
    ##  7 Waterhole_WA   USS0023B17S 2021-12-28     0  -6   -11.4
    ##  8 CentralPark_NY USW00094728 2022-01-15     0  -6   -12.1
    ##  9 Waterhole_WA   USS0023B17S 2022-12-18     0  -5.6 -11.3
    ## 10 Waterhole_WA   USS0023B17S 2022-02-21     0  -4.9 -11.9
    ## # ℹ 2,180 more rows
    ## 
    ## [[3]]
    ## # A tibble: 2,190 × 6
    ##    name           id          date        prcp  tmax  tmin
    ##    <chr>          <chr>       <date>     <dbl> <dbl> <dbl>
    ##  1 Waterhole_WA   USS0023B17S 2021-12-26   102 -11.4 -18.3
    ##  2 Waterhole_WA   USS0023B17S 2021-12-27    25  -9.8 -19.6
    ##  3 CentralPark_NY USW00094728 2022-12-24     0  -9.3 -13.8
    ##  4 Waterhole_WA   USS0023B17S 2022-02-22   102  -9.3 -16.6
    ##  5 Waterhole_WA   USS0023B17S 2021-12-29   102  -7.9 -15.4
    ##  6 CentralPark_NY USW00094728 2022-01-15     0  -6   -12.1
    ##  7 CentralPark_NY USW00094728 2022-01-15     0  -6   -12.1
    ##  8 Waterhole_WA   USS0023B17S 2022-12-18     0  -5.6 -11.3
    ##  9 Waterhole_WA   USS0023B17S 2022-12-18     0  -5.6 -11.3
    ## 10 Waterhole_WA   USS0023B17S 2022-12-18     0  -5.6 -11.3
    ## # ℹ 2,180 more rows

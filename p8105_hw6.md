p8105_hw6
================
Yiying Chen yc4776
2025-12-02

## Problem 1

``` r
library(tidyverse)
homicide_data = read.csv("data/homicide-data.csv")

homicide_data_clean = homicide_data |>
  mutate(city_state = paste(city, state, sep = ", "),
         resolved = case_when(
      disposition == "Open/No arrest"  ~ 0,
      disposition != "Open/No arrest" ~ 1),
      victim_age = as.numeric(victim_age)) |>
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"))|>
  filter(victim_race %in% c("White","Black"))
```

``` r
library(broom)

baltimore_data = 
  homicide_data_clean |>
  filter(city_state == "Baltimore, MD")

set.seed(123)
baltimore_fit = 
  baltimore_data |> 
  glm(resolved ~ victim_age + victim_race + victim_sex, data = _, family = binomial()) 

baltimore_fit |> 
  broom::tidy(exponentiate = TRUE, conf.int = TRUE) |> 
  filter(term == "victim_sexMale") |> 
  select(term, OR = estimate, conf.low, conf.high) |> 
  knitr::kable(digits = 3)
```

| term           |    OR | conf.low | conf.high |
|:---------------|------:|---------:|----------:|
| victim_sexMale | 0.355 |    0.267 |     0.468 |

``` r
city_data =
  homicide_data_clean |>
  group_by(city_state) |>
  tidyr::nest() |>
  mutate(
    city_fit = purrr::map(
      data,
      ~ glm(
          resolved ~ victim_age + victim_sex + victim_race,
          data   = .x,
          family = binomial()
        )
    ),
    city_tidy = purrr::map(
      city_fit,
      ~ broom::tidy(.x, exponentiate = TRUE, conf.int = TRUE)
    )
  ) |>
  tidyr::unnest(city_tidy) |>
  ungroup() |>
  
  filter(term == "victim_sexMale") |>
  select(city_state, estimate, conf.low, conf.high)

city_data
```

    ## # A tibble: 47 × 4
    ##    city_state      estimate conf.low conf.high
    ##    <chr>              <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    0.430   0.132      1.16 
    ##  2 Atlanta, GA        0.512   0.323      0.789
    ##  3 Baltimore, MD      0.355   0.267      0.468
    ##  4 Baton Rouge, LA    0.319   0.160      0.596
    ##  5 Birmingham, AL     0.704   0.444      1.09 
    ##  6 Boston, MA         0.674   0.353      1.28 
    ##  7 Buffalo, NY        0.438   0.239      0.793
    ##  8 Charlotte, NC      0.301   0.143      0.572
    ##  9 Chicago, IL        0.391   0.321      0.476
    ## 10 Cincinnati, OH     0.206   0.0977     0.390
    ## # ℹ 37 more rows

``` r
city_data |>
  mutate(
    city_state = fct_reorder(city_state, estimate)
  ) |>
  ggplot(aes(x = estimate, y = city_state)) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0) +
  labs(
    x = "estimated ORs",
    y = "City",
    title = "Estimated ORs and CIs for each city for solving homicides comparing male victims to female victims"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 6),
    plot.title = element_text(size = 8)
  )
```

![](p8105_hw6_files/figure-gfm/problem_1_plot-1.png)<!-- --> \## Problem
2

``` r
library(tidyverse)
library(p8105.datasets)
data("weather_df")

set.seed(123)
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}

boot_straps = 
  tibble(strap_number = 1:5000) |>
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )

boot_results =
  boot_straps |> 
  mutate(
    boot_fit   = map(strap_sample,\(df) lm(tmax ~ tmin + prcp, data = df)),
    boot_glance = map(boot_fit, broom::glance),   
    boot_tidy   = map(boot_fit, broom::tidy)
  )

boot_results =
  boot_results |>
  mutate(
    r_squared = map_dbl(boot_glance, "r.squared"),
    beta_ratio = map_dbl(
      boot_tidy,
      \(df) {
        b1 <- filter(df, term == "tmin") |> pull(estimate)
        b2 <- filter(df, term == "prcp") |> pull(estimate)
        b1 / b2
      }
    )
  )|>
  select(strap_number, r_squared, beta_ratio)

ggplot(boot_results, aes(x = r_squared)) +
  geom_histogram(bins = 30, color = "white") +
  labs(
    x = expression(R^2),
    title = "Bootstrap distribution of R-squared"
  ) +
  theme_minimal()
```

![](p8105_hw6_files/figure-gfm/problem_2-1.png)<!-- -->

``` r
ggplot(boot_results, aes(x = beta_ratio)) +
  geom_histogram(bins = 30, color = "white") +
  labs(
    x = expression(hat(beta)[1] / hat(beta)[2]),
    title = "Bootstrap distribution of beta1/beta2"
  ) +
  theme_minimal()
```

![](p8105_hw6_files/figure-gfm/problem_2-2.png)<!-- -->

``` r
boot_results |> 
  summarize(
    r2_lower = quantile(r_squared, 0.025),
    r2_upper = quantile(r_squared, 0.975),
    
    ratio_lower = quantile(beta_ratio, 0.025),
    ratio_upper = quantile(beta_ratio, 0.975)
  )
```

    ## # A tibble: 1 × 4
    ##   r2_lower r2_upper ratio_lower ratio_upper
    ##      <dbl>    <dbl>       <dbl>       <dbl>
    ## 1    0.934    0.947       -279.       -125.

\#In the Bootstrap distribution of R-squared, it’s a nearly symmetric
distribution, centered around about 0.94. \#In the Bootstrap
distribution of beta1/beta2, it’s a right-skewed distribution.

## Problem3

``` r
birthweight = 
  read.csv("data/birthweight.csv") |>
  janitor::clean_names() |>
  mutate(
    babysex = as.factor(babysex),
    malform = as.factor(malform),
    mrace   = as.factor(mrace),
    frace   = as.factor(frace)
  )

#Test which variables should be put into the model
fit_birthweight = lm(formula = bwt ~ ., data = birthweight)
summary(fit_birthweight)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ ., data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1097.68  -184.86    -3.33   173.09  2344.15 
    ## 
    ## Coefficients: (3 not defined because of singularities)
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -6265.3914   660.4011  -9.487  < 2e-16 ***
    ## babysex2       28.7073     8.4652   3.391 0.000702 ***
    ## bhead         130.7781     3.4523  37.881  < 2e-16 ***
    ## blength        74.9536     2.0217  37.075  < 2e-16 ***
    ## delwt           4.1007     0.3948  10.386  < 2e-16 ***
    ## fincome         0.2898     0.1795   1.614 0.106551    
    ## frace2         14.3313    46.1501   0.311 0.756168    
    ## frace3         21.2361    69.2960   0.306 0.759273    
    ## frace4        -46.9962    44.6782  -1.052 0.292912    
    ## frace8          4.2969    74.0741   0.058 0.953745    
    ## gaweeks        11.5494     1.4654   7.882 4.06e-15 ***
    ## malform1        9.7650    70.6259   0.138 0.890039    
    ## menarche       -3.5508     2.8951  -1.226 0.220083    
    ## mheight         9.7874    10.3116   0.949 0.342588    
    ## momage          0.7593     1.2221   0.621 0.534418    
    ## mrace2       -151.4354    46.0453  -3.289 0.001014 ** 
    ## mrace3        -91.3866    71.9190  -1.271 0.203908    
    ## mrace4        -56.4787    45.1369  -1.251 0.210901    
    ## parity         95.5411    40.4793   2.360 0.018307 *  
    ## pnumlbw             NA         NA      NA       NA    
    ## pnumsga             NA         NA      NA       NA    
    ## ppbmi           4.3538    14.8913   0.292 0.770017    
    ## ppwt           -3.4716     2.6121  -1.329 0.183913    
    ## smoken         -4.8544     0.5871  -8.269  < 2e-16 ***
    ## wtgain              NA         NA      NA       NA    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 272.5 on 4320 degrees of freedom
    ## Multiple R-squared:  0.7183, Adjusted R-squared:  0.717 
    ## F-statistic: 524.6 on 21 and 4320 DF,  p-value: < 2.2e-16

``` r
model = lm(formula = bwt ~ babysex + bhead + blength + delwt + gaweeks + mrace + parity + smoken, data = birthweight)
summary(model)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ babysex + bhead + blength + delwt + gaweeks + 
    ##     mrace + parity + smoken, data = birthweight)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1119.67  -181.24    -5.87   173.51  2340.76 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5822.5934    98.8325 -58.914  < 2e-16 ***
    ## babysex2       28.6609     8.4951   3.374 0.000748 ***
    ## bhead         131.6982     3.4607  38.056  < 2e-16 ***
    ## blength        75.8653     2.0210  37.538  < 2e-16 ***
    ## delwt           2.2649     0.1961  11.550  < 2e-16 ***
    ## gaweeks        12.1400     1.4654   8.284  < 2e-16 ***
    ## mrace2       -146.7893     9.2435 -15.880  < 2e-16 ***
    ## mrace3        -71.5880    42.4809  -1.685 0.092026 .  
    ## mrace4       -119.5979    18.7656  -6.373 2.04e-10 ***
    ## parity         98.6113    40.5334   2.433 0.015021 *  
    ## smoken         -4.7472     0.5882  -8.071 8.96e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 273.8 on 4331 degrees of freedom
    ## Multiple R-squared:  0.7148, Adjusted R-squared:  0.7142 
    ## F-statistic:  1086 on 10 and 4331 DF,  p-value: < 2.2e-16

### I chose to start with fitting a model using all predictors to examine variable importance and identify potential contributors to birthweight. Then I fit the significant ones again using linear model.
